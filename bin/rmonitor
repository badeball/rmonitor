#!/usr/bin/env ruby

require "commander/import"
require "rmonitor"
require "rmonitor/version"

program :name, "rmonitor"
program :version, RMonitor::VERSION
program :description, "A tool for creating monitor profiles that are easily invoked."

global_option "-c", "--config-path PATH", <<DESC.strip do |path|
  Specify the path to the configuration file (defaults to ~/.config/rmonitor/config.rb)
DESC
  RMonitor::Config.config_path = path
end

command :invoke do |c|
  c.syntax = "invoke [options]"
  c.description = "invoke a profile by name"
  c.option "-n", "--name NAME", String
  c.option "--dry-run", "don't run any destructive commands"
  c.option "--verbose", "print every command ran"
  c.action do |_, options|
    RMonitor::Commands::CL::Invoke.new(
      :verbose => options.verbose,
      :dry_run => options.dry_run
    ).execute(options.name)
  end
end

command :list do |c|
  c.syntax = "list"
  c.description = "lists all available profiles"
  c.action do
    RMonitor::Commands::CL::List.new.execute
  end
end

command :update do |c|
  c.syntax = "update"
  c.description = "invokes the most preferred profile"
  c.option "--dry-run", "don't run any destructive commands"
  c.option "--verbose", "print every command ran"
  c.action do |_, options|
    RMonitor::Commands::CL::Update.new(
      :verbose => options.verbose,
      :dry_run => options.dry_run
    ).execute
  end
end
